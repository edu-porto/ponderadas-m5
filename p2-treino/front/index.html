<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD - Prova</title>
    <script src="https://cdn.jsdelivr.net/npm/htmx.org/dist/htmx.min.js"></script>
</head>
<body>
    <header>
        <h1>HTMX Frontend</h1>
    </header>

    <div>
    <h2>Create a new task </h2>
    <form id="create-task-form">
        <input type="text" name="title" placeholder="New task" required>
        <button type="submit">Add task</button>
    </form>
    </div>

    <button hx-get="http://127.0.0.1:5000/get-tasks" hx-trigger="load" hx-target="#task-list"> Click to get your tasks</button>
    
    <div>
        <ul id="task-list"></ul>
    </div>


    <script>
        document.getElementById('create-task-form').addEventListener('submit', function(event) {
            event.preventDefault();
    
            let title = document.querySelector('input[name="title"]').value;
    
            fetch('http://127.0.0.1:5000/create-task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ task_name: title })
            })
            .then(response => response.json())
            .then(task => {
                addTaskToList(task);
            });
        });

        function deleteTask(event) {
            let taskId = event.target.dataset.taskId;
            fetch(`http://127.0.0.1:5000/delete-task/${taskId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    event.target.parentElement.remove();
                } else {
                    console.error('Failed to delete task');
                }
            });
        }

        function addTaskToList(task) {
            let taskList = document.querySelector('#task-list');
            let li = document.createElement('li');
            
            // Create a text node containing the task title
            let textNode = document.createTextNode(task.task_name);
            li.appendChild(textNode);
            
            let deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.dataset.taskId = task.id;
            deleteButton.addEventListener('click', deleteTask);

            li.appendChild(deleteButton);
            taskList.appendChild(li);
        }

        function displayTasks(tasks) {
            let taskList = document.querySelector('#task-list');
            taskList.innerHTML = ''; // Clear existing tasks
            tasks.forEach(task => {
                addTaskToList(task);
            });
        }

        // Fetch tasks initially
        fetch('http://127.0.0.1:5000/get-tasks')
        .then(response => response.json())
        .then(displayTasks);
    </script>
</body>
</html>
